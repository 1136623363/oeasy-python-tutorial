---
show: step
version: 1.0
enable_checker: true
---

# 语法 html 生成
## 回忆

- 上次可以通过字符串构建一棵etree了
- 这棵树可以删除空格
- 可以控制输出的缩进
- 我能够把前面的requests和这个etree结合起来吗
	- 通过request获得网页
	- 通过etree把他转化为一棵etree树
- 可以么？🤔🤔

### 整合
- requests

```
import requests
response = requests.get("http://localhost/")
s_html = response.content
```
- etree

```
from lxml import etree
html = etree.HTML("<root>  <a/>   <b>  </b>     </root>")
etree.tostring(html)
```

### 整合

```
import requests
from lxml import etree
response = requests.get("http://localhost/oeasy.html")
s_html = response.content
et_html = etree.HTML(s_html)
print(etree.tostring(et_html))
```

- 我是可以生成etree的
- 但是整个网页都下来了
- 我需要的是其中的三种食物
- 如何筛选呢？
- xpath

### 回忆xpath

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630506661307)

```
build_text_list = etree.XPath("//text()") # lxml.etree only!
print(build_text_list(html))
```

### 尝试选择

```
import requests
from lxml import etree
response = requests.get("http://localhost/oeasy.html")
s_html = response.content
et_html = etree.HTML(s_html)
food = et_html.xpath("//html/body/ul/li")
print(food)
```

- xpath选择的是
- html下面的
- body下面的
- ul下面的li

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630506938012)

- 确实找到了三个li

### 乘胜追击

```
from lxml import etree
response = requests.get("http://localhost/oeasy.html")
s_html = response.content
et_html = etree.HTML(s_html)
food = et_html.xpath("//html/body/ul/li")
print(food)
for element in food:
    print(element.text)
```

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630507138409)

- 试验成功

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630507176668)

## 总结

- 把前面的requests和这个etree结合了
	- 通过request获得网页
	- 通过etree把他转化为一棵etree树
	- 通过xpath筛选出节点
	- 通过循环遍历节点进行输出
- 流程跑起来了
- 但是这个xpath有点复杂
- 要从头到尾写得这么麻烦么？
- 有什么技巧吗么？🤔
- 下次再说
