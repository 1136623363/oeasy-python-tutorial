---
show: step
version: 1.0
enable_checker: true
---

# 语法 html 生成
## 回忆

- 上已经在内存构建了一棵etree树了
- 而且可以用xpath的方式访问他
- 而且可以遍历他
- 但是我们的素材是网上爬取的网页源文件
- 如何通过网页源文件得到一棵树呢？🤔


### 从字符串生成

```
some_xml_data = "<root>data</root>"
root = etree.fromstring(some_xml_data)
print(root.tag)
etree.tostring(root)
```

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630503765091)

### 生成

- 可以看到etree可以直接通过字符串生成
- 给他一个字符串
- 他给你一个etree节点
- 节点的根目录标签
- 取决于字符串最外层的标签

### 生成etree

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466004301)

```
root = etree.XML('<html><head/><body><p>Hello<br/>World</p></body></html>')
etree.tostring(root) # default: method = 'xml'
etree.tostring(root, method='xml') # same as above
etree.tostring(root, method='html')
print(etree.tostring(root, method='html', pretty_print=True))
etree.tostring(root, method='text')
```

### 操作

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466164563)


### 修改

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466274184)

```
br = next(root.iter('br'))  # get first result of iteration
br.tail = u'W\xf6rld'
etree.tostring(root, method='text')  # doctest: +ELLIPSIS
etree.tostring(root, method='text', encoding="UTF-8")
```

### 操作

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466681160)

- 我们可以从树上找到br这个节点
- 然后设置他的尾巴
- 这个尾巴不是一般的ascii字符

### utf-8

- 这个字符的unicode编码是`\xf6`
- 编码为utf-8方式后
- 占据两个字节
- 为`\xc3\xb6`

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630466672155)

### 生成html

```
root = etree.HTML("<p>data</p>")
etree.tostring(root)
```

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630504602875)

- 这次应该是可以生成html元素

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630504739828)

- 语法分析器会分析出目前的标签情况
- 而且把他放到html下面的body底下

### 移除空格

```
parser = etree.HTMLParser(remove_blank_text=True)
root = etree.HTML("<root>  <a/>   <b>  </b>     </root>", parser)
etree.tostring(root)
```

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630504914540)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630505103633)

- 可以看到两边的空格删除掉了

### 控制缩进
```
etree.indent(root, space="    ")
print(etree.tostring(root))
etree.indent(root, space="\t")
etree.tostring(root)
```

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630505528348)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210901-1630505481176)

## 总结

- 可以通过字符串构建一棵etree了
- 这棵树可以删除空格
- 可以控制输出的缩进
- 我能够把前面的requests和这个etree结合起来吗
	- 通过request获得网页
	- 通过etree把他转化为一棵etree树
- 可以么？🤔
- 下次再说
